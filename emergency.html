<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>The emergency button</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:ital,wght@1,500;1,800&family=Barlow:ital,wght@1,900&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="icons/icon.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon-E.png">
  </head>
  <body class="theme6">
    <div id='break' class='space'>The emergency button is your ally. If you're having thoughts that could lead to a relapse, don't act on them.</div>
    <div id='uncontrollable' style='display:none;'>
      <input id='search' type='text'><button onclick='search("Google")'>Search (Google)</button><br><button onclick='search("YouTube")'>Search (YouTube)</button><button onclick='search("Twitter")'>Search (Twitter)</button><button onclick='search("DeviantArt")'>Search (DeviantArt)</button><br><button onclick='search("DuckDuckGo")'>Search (DuckDuckGo)</button><button onclick='search("Ecosia")'>Search (Ecosia)</button><br>
      <a onclick='youLearnQuickly()'>I will not search for anything.</a>
    </div>
    <div id='uncontrollable2' style='display:none;'>
      <input id='reason' type='text' style='width:900px; max-width:95%;'>
      <button onclick='submitReason(-1)'>Submit</button>
    </div>
    <div id="never-forget" class="medium space" style="display:none;">Never forget your life objectives.</div>
    <span id='emergency-button' class='stress' onclick="pushTheButton()">EMERGENCY</span>
    <span id='something-else-button' class='big stress' onclick="takeABreak()" style="color:#F60; display:none;">Do Something Else</span>
    <audio id='press'>
      <source src="media/Button Push.mp3" type="audio/mpeg">
    </audio>
    <script>
      var website = "none";
      var a = 0;

      const query = window.location.search;
      if (query !== "") {
        const parameter = new URLSearchParams(query);
        let site = parameter.get('w');
        website = site;
        a = 1;
        if(website === "no")
          youLearnQuickly();
        else {
          let searchTerm = parameter.get('q');
          document.getElementById('search').value = searchTerm;
          submitReason(-1);
        }
      }

      async function pushTheButton() {
        document.getElementById("press").play();
        document.getElementById("emergency-button").style.color = 'white';
        if(website === "none") {
          await sleep(2750);
          document.getElementById("emergency-button").style.display = 'none';
          document.getElementById("break").innerHTML = "You know what? I'm gonna be nice to you. Just search for whatever you want in this convenient place.";
          document.getElementById("uncontrollable").style.display = "block";
          document.getElementById("emergency-button").style.color = 'red';
        } else {
          await sleep(1750);
          eButton();
          await sleep(1750);
          document.getElementById("emergency-button").style.color = 'red';
        }
      }

      document.getElementById("search").addEventListener("keyup", function (event) {
        if (event.keyCode === 13) {
          event.preventDefault();
          search("google");
        }
      });

      document.getElementById("reason").addEventListener("keyup", function (event) {
        if (event.keyCode === 13) {
          event.preventDefault();
          submitReason(-1);
        }
      });

      function youLearnQuickly() {
        website = "no";
        if(a !== 1)
          location.href = "emergency.html?q=blank&w=" + website;
        document.getElementById("break").innerHTML = "You're not going to search for anything? Wow. That was a mature move. I'll bring back the emergency button just for you.";
        document.getElementById("something-else-button").style.display = "block";
      }

      function takeABreak() {
        location.href = "areyouhome.html";
      }

      function search(site) {
        website = site;
        if(document.getElementById("search").value === "")
          document.getElementById("break").innerHTML = "Before I take you to " + site + ", explain why you wanted to go there.";
        else
          document.getElementById("break").innerHTML = "Before I search for \"" + document.getElementById("search").value + "\" for you, explain why you wanted to search it.";
        document.getElementById("uncontrollable").style.display = "none";
        document.getElementById("uncontrollable2").style.display = "block";
      }

      function submitReason(index) {
        let answers = ["you will be doing something <ins>abominable in the sight of God</ins>.", //Religious 1
        "you will have committed <ins>the sin of lust</ins>.", //Religious 2
        "you will have committed a sin. <ins>Do not sin again</ins>.", //Religious 3
        "you will go <ins>against the teachings of Jesus</ins>.", //Religious 4
        "you <ins>will need Jesus</ins> to redeem yourself.", //Religious 5
        "you will be procrasturbating. It's <ins>worse than procrastination</ins>.", //Unhealthy 1
        "you will <ins>screw up your morning</ins> as well as the rest of your day.", //Dangerous 1
        "your future will be <ins>potentially destroyed</ins>.", //Dangerous 2
        "you will become a <ins>sick degenerate</ins>.", //Dangerous 3
        "you will be <ins>throwing your life away</ins>.", //Dangerous 4
        "you will be <ins>further corrupted</ins>.", //Dangerous 5
        "you will be doing something clearly <ins>taboo</ins>.", //Dangerous 6
        "you will relapse. <ins>Going back is very hard</ins> once you start.", //Unhealthy 2
        "you will prioritize <ins>immoral fantasies</ins> over everything else.", //Dangerous 7
        "you will be <ins>abused</ins> by your urges.", //Unhealthy 3
        "you will seek things that <ins>aren't in accordance</ins> with Article of Faith 13.", //Religious 6
        "you will be doing something <ins>dangerous</ins> to your overall health.", //Dangerous 8
        "you will be <ins>doomed to oblivion.</ins>", //Dangerous 9
        "you <ins>won't</ins> have time for <ins>essential tasks</ins> that will help you.", //Unhealthy 4
        "14-year old you will <ins>hate you</ins>.", //Unhealthy 5
        "you will be <ins>unclean</ins> and won't make it to heaven.", //Religous 7
        "you will <ins>regret it</ins>.", //Unhealthy 6
        "the <ins>Second Coming</ins> will be catastrophic if it happens in a few hours.", //Religious 8
        "you will feel <ins>weak and incapable</ins>.", //Unhealthy 7
        "you will wish you <ins>had done something else</ins>.", //Unhealthy 8
        "you will give in to a <ins>terrible craving</ins>.", //Unhealthy 9
        "your <ins>addiction</ins> will get <ins>worse</ins>.", //Unhealthy 10
        "<ins>nothing good</ins> will come out of satisfying that craving.", //Unhealthy 11
        "Satan will <ins>manipulate you</ins>.", //Religious 9
        "you will feel a little satisfied, but then <ins>you'll feel miserable</ins>."]; //Unhealthy 12

        if(a !== 1)
          location.href = "emergency.html?q=" + document.getElementById("search").value + "&w=" + website;
        if(index < 0 || index >= answers.length)
          index = Math.floor(Math.random() * answers.length);
        let consequence = answers[index];
        if(document.getElementById("search").value === "")
          document.getElementById("break").innerHTML = "I will not let you go to " + website + "! If you go there, " + consequence;
        else
          document.getElementById("break").innerHTML = "I will not search for \"" + document.getElementById("search").value + "\" for you! If you search for it on any website, " + consequence;
        document.getElementById("uncontrollable2").style.display = "none";
        document.getElementById("never-forget").style.display = "block";
        document.getElementById("emergency-button").style.display = "inline";
      }

      function eButton() {
        let array = [];
        let message = document.getElementById("break").innerHTML;
        let i = 0;
        if(message.indexOf("Second Coming") >= 0)
          array.push("https://www.thetabernaclechoir.org/listen.html");
        else if(found(["God","Jesus","Faith","sin","heaven"],message)) {
          for (i = 0; i < 8; i++) {
            if (i < 4)
              array.push("repent2.html");
            else if (i < 5)
              array.push("https://youtu.be/iC4aV5WutY0"); //Place no more for the enemy of my soul
            else if (i < 6)
              array.push("https://dynalist.io/d/PQDJvhu4f3DRlgGhkcMQA32T");
            else
              array.push("https://emergency.nofap.com/redirect?religious=true&cat=em");
          }
        }
        else {
          for (i = 0; i < 21; i++) {
            if (i < 1)
              array.push("whoa/old.html?id=24");
            else
              array.push("https://emergency.nofap.com/redirect?religious=true&cat=em");
          }
        }
        var j = 0;
        while(j < array.length/4) {
          array.push("bigbreak.html");
          j++;
        }
        i = Math.floor(Math.random() * array.length);
        location.href = array[i];
      }

      function found(array,inputText) {
        for (var i in array)
          if (inputText.indexOf(array[i]) >= 0)
            return true;
        return false;
      }

      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    </script>
  </body>
</html>
