<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Anime Timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:ital,wght@1,500;1,800&family=Barlow:ital,wght@1,900&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="icons/icon-clock.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  </head>
  <body class="theme5">
    <h1 id="message">Set the timer.</h1>
    <div id='times'>
      <h3 class='space2'>
        <span style='left:10%; position:absolute;' onclick="moveTime(-1)">⬅️</span>
        <span id='time'>30 minutes (A)</span>
        <span style='right:10%; position:absolute;' onclick="moveTime(1)">➡️</span>
      </h3>
      <span id='start' class='timerbutton' style='background-color:rgb(0,255,0); color:black;' onclick='startTimer()'>Start</span>
    </div>
    <div id='additionalTimes' class='space2' style='display:none;'>
      <a id='thirty-seconds-plus' class='timerbutton' style='background-color:rgb(0,102,255); color:black; display:none;' onclick='addTime(30)'>Add 30 Seconds (3)</a>
      <a id='ten-minutes-plus' class='timerbutton' style='background-color:rgb(0,102,255); color:black; display:none;' onclick='addTime(600)'>Add 10 Minutes (3)</a>
      <a id='twenty-minutes-plus' class='timerbutton' style='background-color:rgb(0,102,255); color:black; display:none;' onclick='addTime(1200)'>Add 20 Minutes (3)</a>
    </div>
    <div id='controls' class='two-list space' style='display:none;'>
      <a id='pause' class='timerbutton' style='background-color:yellow; color:black;' onclick='pauseTimer()'>Pause Timer</a>
      <a id='stop' class='timerbutton' style='background-color:red; color:black;' onclick='stopAlarm()'>Stop Timer</a>
    </div>
    <div id='two-hours' style='display:none;'>
      <h3>Things to do during break</h3>
      <div class='two-list'>
        <a class='hfire-link extended' href='animeutilities.html' target='_blank'>Update AniList and Anime Spreadsheet</a>
        <span class='hfire-span'>Drink water</span><a class='hfire-link' href='https://app.diagrams.net/#G1UCqHtj3kuSZ1UPVXut0o7vF1XV9e0J8b' target='_blank'>Relax/Meditate</a>
        <span class='hfire-span'>Tackle your search terms list</span><span class='hfire-span'>Organize iTunes Library</span>
        <a class='hfire-link' href='https://deepstash.com/' target='_blank'>Check Deepstash</a><a class='hfire-link' href='https://skl.sh/3FMbwZa' target='_blank'>Take that Full Stack course on Skillshare (2x)</a>
        <span class='hfire-span'>Use the Finch App</span><a class='hfire-link' href='stepmania.html' target='_blank'>Play Stepmania (pad)</a>
        <span class='hfire-span'>Digitize your journal</span><span class='hfire-span'>Play a game like BeamNG.drive</span>
      </div>
    </div>
    <audio loop id='alarm'>
      <source src="media/mixkit-uplifting-bells-notification-938.wav" type="audio/mpeg">
    </audio>
    <script>
      //a is for alarm, n is for now.
      var a = new Date();
      var n = new Date();
      //global variable that keeps track of time
      var myfunc;
      //global variable that detects if the alarm has gone off.
      var alarmOff = false;
      //initializes the tp variable for the moveTime function as an array pointer.
      var tp = 2;
      //initializes the addTimes variable for the adjustTime function. It keeps track of how many more times the addTime button can be pressed.
      var addTimes = 3;

      //Each array element describes the length of the timer.
      var times = ["5 Seconds (A)",
      "5 Minutes (C)",
      "30 Minutes (A)",
      "1 Hour (A)",
      "1 Hour (B)",
      "2 Hours (B)"];

      var urlSearch = window.location.search;
      console.log(urlSearch);
      if (urlSearch !== "") {
        var parameter = new URLSearchParams(urlSearch);
        var defaultTime = parameter.get('time');
        if(defaultTime = "2h") {
          tp = 5;
          document.getElementById("time").innerHTML = times[tp];
        }
      }

      function moveTime(distance) {
        //moves the array position via the distance parameter.
        tp = tp + distance;
        //corrects the array's position if it's too low or too high
        if(tp === 6)
          tp = 0;
        else if(tp === -1)
          tp = 5;
        console.log(tp);
        //Changes the value in the selection area
        document.getElementById("time").innerHTML = times[tp];
      }

      function startTimer() {
        //This matrix is used to store hours, minutes, and seconds for the timer.
        var timeArray = [
        [0,0,0,1,1,2],
        [0,5,30,0,0,0],
        [5,0,0,0,0,0]];
        //The hours, minutes, and seconds are set depending on the timer's setting when starting for the first time.
        var hours = timeArray[0][tp];
        var minutes = timeArray[1][tp];
        var seconds = timeArray[2][tp];
        setTimer(hours,minutes,seconds);
      }

      function setTimer(hours,minutes,seconds) {
        //Sets n to the current time
        n = new Date(Date.now());
        //Displays current time to the console
        console.log("Current time: " + n.getHours() + ":" + n.getMinutes() + ":" + n.getSeconds());

        //Sets the alarm's second value by adding seconds from the parameter to the current time's second value.
        a.setSeconds(seconds + n.getSeconds());
        //Sets the alarm's minute value by adding minutes from the parameter to the current time's minute value.
        a.setMinutes(minutes + n.getMinutes());
        if(a.getSeconds() < n.getSeconds())
        {
          console.log("Hey. It is known that the second value of the alarm " + a.getSeconds() + " is less than the second value of the current time " + n.getSeconds());
          //Adds one minute to the alarm's minute value.
          a.setMinutes(1 + a.getMinutes());
        }
        //Sets the alarm's hour value by adding hours from the parameter to the current time's hour value.
        a.setHours(hours + n.getHours());
        if(a.getMinutes() === n.getMinutes() && a.getSeconds() < n.getSeconds() || a.getMinutes() < n.getMinutes())
        {
          if(a.getMinutes() === n.getMinutes() && a.getSeconds() < n.getSeconds()) {
            console.log("Hey. It is known that the minute value of the alarm " + a.getMinutes() + " is equal to the minute value of the current time " + n.getMinutes());
            console.log("AND It is known that the second value of the alarm " + a.getSeconds() + " is less than the second value of the current time " + n.getSeconds());
          }
          else
            console.log("Hey. It is known that the minute value of the alarm " + a.getMinutes() + " is less than the minute value of the current time " + n.getMinutes());
          //Adds one hour to the alarm's minute value.
          a.setHours(1 + a.getHours());
        }
        //Displays alarm time to the console
        console.log("Alarm will go off at " + a.getHours() + ":" + a.getMinutes() + ":" + a.getSeconds());

        //Displays remaining time to the webpage
        adjustTime();

        //This function keeps track of time. It updates the timer and sets off the alarm when the current time matches the alarm time.
        myfunc = setInterval(function() {
          n = new Date(Date.now())
          if(!alarmOff)
            adjustTime();
          if(n.getTime() >= a.getTime())
          /*if(n.getSeconds() === a.getSeconds() && n.getMinutes() === a.getMinutes() && n.getHours() === a.getHours())*/ {
            alarmOff = true;
            playAlarm();
            document.getElementById("additionalTimes").style.display = "none";
            document.getElementById("message").innerHTML = "<span id='stress' onclick='stopAlarm()'>STOP TIMER</span>";
            document.title = "0:00";
          }
          if(n.getTime() - a.getTime() >= 30000)
            stopAlarm();
        }, 1000);

        document.getElementById("times").style.display = "none";
        //Only when the timer is set to 30 minutes or 1 hour does this element display for adding time to the timer.
        if(tp === 0 || tp === 2 || tp === 3)
          document.getElementById("additionalTimes").style.display = "block";
        if(tp === 0)
          document.getElementById("thirty-seconds-plus").style.display = "inline";
        else if(tp === 2)
          document.getElementById("ten-minutes-plus").style.display = "inline";
        else if(tp === 3)
          document.getElementById("twenty-minutes-plus").style.display = "inline";
        else if(tp >= 4) {
          document.getElementById("two-hours").style.display = "block";
        }
        //This displays the controls for pausing and stopping the timer.
        document.getElementById("controls").style.display = "block";
      }

      function adjustTime() {
        //This calculates how much time is left between the alarm and the current time.
        var timeLeft = a - n;
        //Hours, minutes, and seconds are calculated from that value.
        var hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        //Add zeroes to minutes and seconds if the number is a single digit long.
        if(seconds.toString().length === 1)
          seconds = "0" + seconds;
        if(minutes.toString().length === 1 && hours > 0)
          minutes = "0" + minutes;
        //Updates the document title
        document.title = hours > 0 ? hours + ":" + minutes + ":" + seconds : minutes + ":" + seconds;
        //Displays updated remaining time to the webpage
        if(minutes.toString().length === 1)
          minutes = "0" + minutes;
        document.getElementById("message").innerHTML = "<span id='hours'>" + hours + "</span>:<span id='minutes'>" + minutes + "</span>:<span id='seconds'>" + seconds + "</span>";
      }

      function addTime(seconds) {
        //A new alarm is made.
        var aa = new Date();
        //Displays old alarm's time
        console.log("The alarm would go off at " + a.getHours() + ":" + a.getMinutes() + ":" + a.getSeconds());

        aa.setSeconds(seconds + a.getSeconds());
        if(seconds < 60 && aa.getSeconds() < a.getSeconds())
          aa.setMinutes(1 + a.getMinutes())
        else
          aa.setMinutes(seconds/60 + a.getMinutes());
        if(seconds < 3600 && aa.getMinutes() < a.getMinutes())
          aa.setHours(1 + a.getHours());
        else
          aa.setHours(seconds/3600 + a.getHours());
        //Ensures the timer does not display negative values by adding the date by 1 if the new alarm time would happen before the current time. (e.g., 12:30AM alarm set at 11:30PM)
        if(aa - n < 0)
          aa.setDate(aa.getDate() + 1);
        //Displays new alarm's time
        console.log("But now it will got off at " + aa.getHours() + ":" + aa.getMinutes() + ":" + aa.getSeconds());
        //Set the current alarm to the new alarm.
        a = aa;
        //Increments the addTimes variable
        addTimes--;
        var timerButton;
        if(document.getElementById("thirty-seconds-plus").style.display === "inline") {
          timerButton = document.getElementById("thirty-seconds-plus");
          timerButton.innerHTML = "Add 30 Seconds (" + addTimes + ")";
        }
        else if(document.getElementById("ten-minutes-plus").style.display === "inline") {
          timerButton = document.getElementById("ten-minutes-plus");
          timerButton.innerHTML = "Add 10 Minutes (" + addTimes + ")";
        }
        else if(document.getElementById("twenty-minutes-plus").style.display === "inline") {
          timerButton = document.getElementById("twenty-minutes-plus");
          timerButton.innerHTML = "Add 20 Minutes (" + addTimes + ")";
        }
        //If button is pressed 3 times, disables the add 10 minutes button by removing the onclick attribute and changing the appearance to black with the text "BUTTON DISABLED".
        if(addTimes <= 0) {
          timerButton.removeAttribute("onclick");
          timerButton.innerHTML = "BUTTON DISABLED";
          timerButton.style.color = timerButton.style.backgroundColor;
          timerButton.style.backgroundColor = 'black';
        }
        adjustTime();
      }

      var pausedBefore = false;
      function pauseTimer() {
        //This freezes the timer.
        clearInterval(myfunc);
        //Changes what the pause button does and looks like
        var pauseButton = document.getElementById("pause");
        pauseButton.innerHTML = "Resume Timer";
        pauseButton.removeEventListener("click", pauseTimer);
        pauseButton.addEventListener("click", resumeTimer);
        pausedBefore = true;
      }

      function resumeTimer() {
        //Changes what the resume button does and looks like.
        var pauseButton = document.getElementById("pause");
        pauseButton.innerHTML = "Pause Timer";
        if(pausedBefore)
          pauseButton.removeEventListener("click", resumeTimer);
        pauseButton.addEventListener("click",pauseTimer);
        //Extracts the hours, minutes, and seconds from the
        var hours = document.getElementById('hours').innerHTML;
        var minutes = document.getElementById('minutes').innerHTML;
        var seconds = document.getElementById('seconds').innerHTML;
        //Displays the timer's value to the console
        console.log("Time left is " + hours + ":" + minutes + ":" + seconds);
        //Passes the arguments to the setTimer function to resume the timer.
        setTimer(parseInt(hours),parseInt(minutes),parseInt(seconds));
      }

      function playAlarm()
      {
        alarm.play();
      }

      function stopAlarm()
      {
        if(tp >= 4)
          location.href = "anime.html";
        else if(tp === 2 || tp === 3)
          location.href = "animetimer.html?time=2h";
        else
          location.href = "animetimer.html";
      }
    </script>
  </body>
</html>
