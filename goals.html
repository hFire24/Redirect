<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Keep this open! Your goals</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:ital,wght@1,500;1,800&family=Barlow:ital,wght@1,900&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="icons/icon-star.ico">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon G.png">
  </head>
  <body>
    <h1 id='message'>Your current goals</h1>
    <div id='best-results' class='space'>For best results, keep this page open during the day.<br>
    If you're done with a goal, press the key corresponding to that goal to hide it.<br>
    If you're struggling to do the next goal, <a href='struggle2.html' target='_blank'>click here.</a><br>
    To export your tasks, <a href='#exportArea' onclick='exportGoals()'>click here.</a></div>
    <div id='goals-list' class='two-list' style="width:95%; margin:auto;">
    </div>
    <div class='space'></div>
    <div id='exportRegion'>
      <textarea id='exportArea' cols='50' rows='8'></textarea>
      <button onclick='exportGoals()'>Export</button> <button onclick='copyToClipboard()'>Copy</button> <button onclick='undoText()'>Undo</button>
    </div>
    <script>
      var aHabits = [{text:"Tackle your to-do list",link:"index.html",category:"active"},
        //aHabits
      {text:"Play Stepmania on pad <span class='time'>(3 songs)</span>",link:"stepmania.html",category:"golden"}, //Golden habits are the most important
      //{text:"Apply for a job <span class='time'>(1 job)</span>",link:"pass",category:"golden"},
      //{text:"*Draw something <span class='time'>(1+ times)</span>",link:"quiz.html",category:"golden"},
      //{text:"Manage money, write in journal",link:"pass",category:"active"},
        //bHabits
      {text:"Read the book <u>Atomic Habits</u> <span class='time'>(2 quotes to add)</span>",link:"https://read.amazon.com/",category:"active"},
      //{text:"Learn Rubik's Cube algorithms <span class='time'>(2 mintues)</span>",link:"https://www.rubiks.com/media/guides/RBL_solve_guide_CUBE_US_5.375x8.375in_AW_27Feb2020_VISUAL.pdf/",category:"active"},
      //{text:"Play Duolingo <span class='time'>(1 lesson)</span>",link:"https://www.duolingo.com/",category:"active"},
      {text:"Relax/meditate <span class='time'>(2 sessions)</span>",link:"https://www.notion.so/cb8aa85e9b8e4ad98d432242a771288e?v=612e0d0470f34ff4bb722f1177531b4e",category:"passive"},
      //{text:"Code some stuff in C# <span class='time'>(10 minutes)</span>",link:"pass",category:"active"},
      //{text:"Play Elevate <span class='time'>(5 minutes)</span>",link:"pass",category:"active"},
      {text:"Listen to General Conference <span class='time'>(15 minutes)</span>",link:"https://dynalist.io/d/PQDJvhu4f3DRlgGhkcMQA32T",category:"passive"},
      {text:"Digitize fifth journal <span class='time'>(1 page)</span>",link:"https://cfreeze-jprogress.herokuapp.com",category:"active"},
      {text:"Watch anime <span class='time'>(1 episode)</span>",link:"nextanime.html",category:"active"},
        //cHabits
      {text:"Analyze songs <span class='time'>(1 song)</span>",link:"pass",category:"active"},
      //{text:"Play Touhou <span class='time'>(2 games)</span>",link:"pass",category:"active"}
      //{text:"Play 100% Orange Juice <span class='time'>(2-3 games)</span>",link:"pass",category:"active"}
      //{text:"Play Sudoku (Medium) <span class='time'>(1 puzzle)</span>",link:"https://www.websudoku.com/",category:"active"},
      //{text:"Play Linkdoku <span class='time'>(3 puzzles)</span>",link:"pass",category:"active"},
      //{text:"Play I Love Hue <span class='time'>(15 minutes)</span>",link:"pass",category:"active"},
      //{text:"Play Minesweeper <span class='time'>(1 solve)</span>",link:"http://minesweeper.online",category:"active"},
      //{text:"Play Smash Ultimate <span class='time'>(30 minutes)</span>",link:"pass",category:"active"},
      //{text:"Play Pokemon Showdown! <span class='time'>(2-3 <span id='tier'></span> battles)</span>",link:"https://play.pokemonshowdown.com/",category:"active"}
      //{text:"Play Bloons Tower Defense 6 <span class='time'>(Infinity)</span>",link:"pass",category:"active"}
      //{text:"Watch Only Connect <span class='time'>(30 minutes)</span>",link:"https://www.youtube.com/playlist?list=PLrlSc8gCDlytPSFpUdu9Y64Sy5ijWUzd-",category:"passive"}];
      ];
      shuffle(aHabits);

      //cHabits = cHabits.slice(0,5);

      function shuffle(array) {
        for (var i = array.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * i);
          var temp = array[i];
          array[i] = array[j];
          array[j] = temp;
        }
      }

      var parent = document.getElementById("goals-list");

      function buildArray(array,offset) {
        for(var i = 0; i < array.length; i++) {
          var element = document.createElement("a");
          var letter = String.fromCharCode(65+offset+i);
          element.id = "habit-" + letter;
          element.classList.add("hfire-link");
          element.innerHTML = letter + ": " + array[i].text;
          if(array[i].link !== "pass") {
            element.href = array[i].link;
            element.target = "_blank";
          }
          parent.appendChild(element);
          //Creates a random background color for the element
          var x = Math.floor(Math.random() * 128);
          var y = Math.floor(Math.random() * 128);
          var z = Math.floor(Math.random() * 32) + 96;
          var bgColor = "rgb(" + x + "," + y + "," + z + ")";
          if(array[i].text.indexOf("Cirno") >= 0)
            bgColor = "rgb(30,105,192)";
          element = document.getElementById("habit-" + letter)
          element.style.backgroundColor = bgColor;
          console.log(array[i]);
          if(array[i].category === "passive")
            element.style.color = "#3CF";
          else if(array[i].category === "golden")
            element.style.color = "gold";
        }
      }

      class Tier {
        constructor(number) {
          this.number = number;
        }
        getNumber() {
          return this.number;
        }
        setNumber(number) {
          this.number = number;
        }
      }

      buildArray(aHabits,0);
      //buildArray(bHabits,aHabits.length);
      //buildArray(cHabits,aHabits.length + bHabits.length);
      var tierNumber = new Tier(-1);
      getTier(tierNumber);

      function getTier(tierObject) {
        var d = new Date();
        var tiers = ["OU","UU","RU","NU","PU"];
        console.log("Tier Number is " + tierObject.getNumber());
        if(document.getElementById("tier")) {
          if(d.getDay() >= 1 && d.getDay() <= 5)
            tierObject.setNumber(d.getDay() - 1);
          else if(tierObject.getNumber() === -1)
            tierObject.setNumber(Math.floor(Math.random() * 5));
          tier.innerHTML = tiers[tierObject.getNumber()];
          console.log("The Tier Number is " + tierObject.getNumber());
        }
      }

      window.onbeforeunload = function() { return "Would you really like to leave this page?"; }
      window.onkeyup = function(){deleteText(event)};

      var deletedElements = [];

      function deleteText(id) {
        console.log(id.key.toUpperCase());
        //For potential future proofing
        if(document.getElementById("habit-" + id.key.toUpperCase()) === null)
          return;
        var toBeDisabled = document.getElementById("habit-" + id.key.toUpperCase());
        toBeDisabled.style.color = toBeDisabled.style.backgroundColor;
        toBeDisabled.removeAttribute("href");
        deletedElements.push(id.key);
        for(var i = 0; i < deletedElements.length - 1; i++) {
          if(deletedElements[i] === id.key) {
            deletedElements.pop();
            break;
          }
        }
        console.log(deletedElements);
        if(deletedElements.length === aHabits.length) {
          document.getElementById("message").innerHTML = "CONGRATULATIONS!";
          document.getElementById("best-results").innerHTML = "You did them all in one day!";
          document.getElementById("best-results").className = "medium";
          document.body.removeChild(parent);
          document.body.removeChild(document.getElementById("exportRegion"));
          changeColor();
        }
      }

      function undoText() {
        if (deletedElements.length === 0)
          return;
        var letter = deletedElements[deletedElements.length - 1].toUpperCase();
        var aHabitsIndex = letter.charCodeAt(0) - 65;
        var toBeRestored = document.getElementById("habit-" + letter);
        if(aHabits[aHabitsIndex].category === "passive")
          toBeRestored.style.color = "#3CF";
        else if(aHabits[aHabitsIndex].category === "golden")
          toBeRestored.style.color = "gold";
        else
          toBeRestored.style.color = "white"
        deletedElements.pop();
      }

      function exportGoals() {
        var text = document.getElementById("exportArea");
        text.value = "";
        var bigArray = document.getElementsByClassName("hfire-link");
        for(var i = 0; i < bigArray.length; i++)
          if(bigArray[i].style.color !== bigArray[i].style.backgroundColor)
          {
            var preText = bigArray[i].innerText || bigArray[i].textContent;
            text.value = text.value + preText;
            if(i < bigArray.length-1)
              text.value = text.value + "\r\n";
          }
      }

      function copyToClipboard() {
        /* Get the text field */
        var copyText = document.getElementById("exportArea");

        /* Select the text field */
        copyText.select();
        copyText.setSelectionRange(0, 99999); /*For mobile devices*/

        /* Copy the text inside the text field */
        document.execCommand("copy");

        /* Alert the copied text */
        alert("Copied the text: " + copyText.value);
      }

      function swapGoals(a, b) {
        //Converts the letters to numbers for the array
        a = a.toUpperCase().charCodeAt(0) - 65;
        b = b.toUpperCase().charCodeAt(0) - 65;
        console.log(a + " " + b);
        //Throws this error if one of the values is out of range
        if(a < 0 || b < 0 || a >= aHabits.length || b >= aHabits.length)
          console.log("ERROR: One of the goal letters does not exist");
        else {
          //Swaps the goals within the array
          var temp = aHabits[a];
          aHabits[a] = aHabits[b];
          aHabits[b] = temp;
          //Creates a new temporary array for the swapped elements for the loop
          var swappedGoals = [aHabits[a],aHabits[b]];
          //Adds the number and background color properties for the elements
          swappedGoals[0].num = a;
          swappedGoals[1].num = b;
          //These are reversed so that when the elements are swapped, they get to keep their background colors.
          swappedGoals[0].backgroundColor = document.getElementById("habit-" + String.fromCharCode(65+swappedGoals[1].num)).style.backgroundColor;
          swappedGoals[1].backgroundColor = document.getElementById("habit-" + String.fromCharCode(65+swappedGoals[0].num)).style.backgroundColor;
          //This is where the swapping takes place. All the swapped elements come from the newly created swappedGoals array.
          for(var i = 0; i < swappedGoals.length; i++) {
            //Gets the position of one of the swapped goals.
            var letter = String.fromCharCode(65+swappedGoals[i].num);
            var element = document.getElementById("habit-" + letter);
            //The text, link, and color data are transferred to the other HTML element being swapped.
            element.innerHTML = letter + ": " + swappedGoals[i].text;
            if(swappedGoals[i].link !== "pass") {
              element.href = swappedGoals[i].link;
              element.target = "_blank";
            }
            console.log(swappedGoals[i].backgroundColor);
            element.style.backgroundColor = swappedGoals[i].backgroundColor;
            if(swappedGoals[i].category === "passive")
              element.style.color = "#7BF";
            else if(swappedGoals[i].category === "golden")
              element.style.color = "gold";
            else
              element.style.color = "white";
          }
          getTier(tierNumber);
        }
      }

      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function changeColor() {
        while(true) {
          await sleep(100);
          bgHue += 7.5;
          textHue += 7.5;
          if(bgHue >= 360)
            bgHue -= 360;
          if (textHue >= 360)
            textHue -= 360;
          document.body.style.backgroundColor = "hsl(" + bgHue.toString() + ", 30%, 32%)";
          document.body.style.color = "hsl(" + textHue.toString() + ", 22%, 87%)";
        }
      }

      var bgHue = 137;
      var textHue = 104;
    </script>
  </body>
</html>
