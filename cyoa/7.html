<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Do math.</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="icon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
  </head>
  <body class="theme3">
    <div id='break' class='space'>OK, fine. Solve some math problems.</div>
    <div id='bringit' class='animelink' onclick=startMath()>Bring it on!</div>
    <div id='math' style='display:none;'>
      <div class='space'><span id="mathproblem" class='number'></span> = <span id="mathanswer" class='number'></span></div>
      <div id='mathpad'>
        <div class='number' onclick='type(7)'>7</div> <div class='number' onclick='type(8)'>8</div> <div class='number' onclick='type(9)'>9</div>
        <div class='number' onclick='type(4)'>4</div> <div class='number' onclick='type(5)'>5</div> <div class='number' onclick='type(6)'>6</div>
        <div class='number' onclick='type(1)'>1</div> <div class='number' onclick='type(2)'>2</div> <div class='number' onclick='type(3)'>3</div>
        <div class='number' onclick='type(0)'>0</div> <div class='number' onclick='type("-")'>←</div> <div id='enter' class='number' style='color:#0F0;'>↵</div>
      </div>
    </div>
    <script>
    var difficulty = 6;
    var correctStreak = 0;
    var incorrectStreak = 0;
    var number1;
    var number2;
    var number3;

    function startMath() {
      document.getElementById("bringit").style.display = "none";
      document.getElementById("math").style.display = "block";
      loadMath();
    }

    function loadMath() {
      var answer = document.getElementById("mathanswer");
      answer.style.color = "hsl(284, 22%, 87%)";
      answer.innerHTML = "";
      document.getElementById("enter").addEventListener("click",submit);
      switch (difficulty)
      {
        case 1:
          document.getElementById("break").innerHTML = "Level 1: Noob";
          number1 = getNumber(1);
          number2 = getNumber(1);
          document.getElementById("mathproblem").innerHTML = number1 + " + " + number2;
          break;
        case 2:
          document.getElementById("break").innerHTML = "Level 2: Easy";
          number1 = getNumber(2);
          number2 = getNumber(1);
          document.getElementById("mathproblem").innerHTML = number1 + " + " + number2;
          break;
        case 3:
          document.getElementById("break").innerHTML = "Level 3: Medium";
          number1 = getNumber(2);
          number2 = getNumber(2);
          document.getElementById("mathproblem").innerHTML = number1 + " + " + number2;
          break;
        case 4:
          document.getElementById("break").innerHTML = "Level 4: Somewhat Hard";
          number1 = getNumber(2);
          number2 = getNumber(2);
          number3 = getNumber(2);
          document.getElementById("mathproblem").innerHTML = number1 + " + " + number2 + " + " + number3;
          break;
        case 5:
          document.getElementById("break").innerHTML = "Level 5: Hard";
          number1 = getNumber(2);
          number2 = getNumber(1);
          number3 = 0;
          document.getElementById("mathproblem").innerHTML = number1 + " × " + number2;
          break;
        case 6:
          document.getElementById("break").innerHTML = "Level 6: Super Hard";
          number1 = getNumber(2);
          number2 = getNumber(1);
          number3 = getNumber(2);
          document.getElementById("mathproblem").innerHTML = number1 + " × " + number2 + " + " + number3;
          break;
        case 7:
          document.getElementById("break").innerHTML = "Level 7: Insane";
          number1 = getNumber(2);
          number2 = getNumber(2);
          number3 = 0;
          document.getElementById("mathproblem").innerHTML = number1 + " × " + number2;
          break;
        case 8:
          document.getElementById("break").innerHTML = "Level 8: Absurd";
          number1 = getNumber(2);
          number2 = getNumber(2);
          number3 = getNumber(3);
          document.getElementById("mathproblem").innerHTML = number1 + " × " + number2 + " + " + number3;
          break;
        case 9:
          document.getElementById("break").innerHTML = "Level 9: Impossible";
          number1 = getNumber(3);
          number2 = getNumber(2);
          number3 = getNumber(4);
          document.getElementById("mathproblem").innerHTML = number1 + " × " + number2 + " + " + number3;
          break;
      }
    }

    function getNumber(digits)
    {
      if(digits === 1)
        return Math.floor(Math.random() * 9) + 1;
      else if(digits === 2)
        return Math.floor(Math.random() * 90) + 10;
      else if(digits === 3)
        return Math.floor(Math.random() * 900) + 100;
      else if(digits === 4)
        return Math.floor(Math.random() * 9000) + 1000;
    }

    function type(number) {
      var answer = document.getElementById("mathanswer");
      if(answer.innerHTML === '' && number !== "-")
        answer.innerHTML = number;
      else if(number === "-" && number.length > 0)
        answer.innerHTML = answer.innerHTML.substring(0,answer.innerHTML.length-1);
      else
        answer.innerHTML = answer.innerHTML + number.toString();
    }

    async function submit() {
      document.getElementById("enter").removeEventListener("click",submit);
      var mathAnswer = document.getElementById("mathanswer");
      var answer = parseInt(mathAnswer.innerHTML);
      var message = document.getElementById("break");
      if(number1 + number2 === answer && difficulty < 4 ||
        number1 + number2 + number3 === answer && difficulty === 4 ||
        number1 * number2 + number3 === answer) {
        incorrectStreak = 0;
        correctStreak++;
        message.innerHTML = generatePraiseMessage();
        mathAnswer.style.color = "#0F0";
      }
      else {
        correctStreak = 0;
        incorrectStreak++;
        message.innerHTML = generateWrongMessage();
        mathAnswer.style.color = "#F00";
        if(difficulty < 4)
          answer = number1 + number2;
        else if(difficulty === 4)
          answer = number1 + number2 + number3;
        else
          answer = number1 * number2 + number3;
        mathAnswer.innerHTML = answer.toString();
      }
      if(correctStreak >= 3 && difficulty < 9) {
        correctStreak = 0;
        difficulty++;
      }
      else if(incorrectStreak >= 3 && difficulty > 1) {
        incorrectStreak = 0;
        difficulty--;
      }
      console.log("correctStreak: " + correctStreak);
      console.log("incorrectStreak: " + incorrectStreak);
      if(difficulty > 4)
        await sleep(2500);
      else
        await sleep(1500);
      if(incorrectStreak > 0)
        switch(difficulty)
        {
          case 1:
            await sleep(500);
            break;
          case 2:
            await sleep(600);
            break;
          case 3:
            await sleep(800);
            break;
          case 4:
            await sleep(1000);
            break;
          case 5:
            await sleep(500);
            break;
          case 6:
            await sleep(600);
            break;
          case 7:
            await sleep(800);
            break;
          case 8:
            await sleep(1000);
            break;
          case 9:
            await sleep(1500);
            break;
        }
      loadMath();
    }

    function generatePraiseMessage() {
      var messages = ["You're on fire!"];
      var index = Math.floor(Math.random() * messages.length);
      return messages[index];
    }

    function generateWrongMessage() {
      var messages = ["Ouch!"];
      var index = Math.floor(Math.random() * messages.length);
      return messages[index];
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    </script>
  </body>
</html>
